<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Calculadora Programaci√≥n Lineal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

    <!-- Theme Toggle: pill switch (sun = light, moon = dark) -->
    <button type="button" class="theme-toggle" id="dark-mode-toggle" role="switch" aria-checked="false" aria-label="Cambiar tema claro/oscuro" title="Cambiar modo oscuro/claro">
        <span class="theme-toggle-track">
            <span class="theme-toggle-slot theme-toggle-slot-sun" aria-hidden="true">
                <svg class="theme-toggle-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>
            </span>
            <span class="theme-toggle-slot theme-toggle-slot-moon" aria-hidden="true">
                <svg class="theme-toggle-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
            </span>
            <span class="theme-toggle-thumb" aria-hidden="true">
                <svg class="theme-toggle-thumb-icon theme-toggle-thumb-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>
                <svg class="theme-toggle-thumb-icon theme-toggle-thumb-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
            </span>
        </span>
    </button>

    <h1>Calculadora Programaci√≥n Lineal</h1>

    <!-- Tabs para cambiar entre m√©todos -->
    <div class="tabs-container">
        <button class="tab-button active" onclick="cambiarMetodo('grafico')">M√©todo Gr√°fico</button>
        <button class="tab-button" onclick="cambiarMetodo('simplex')">M√©todo Simplex</button>
        <button class="tab-button" onclick="cambiarMetodo('dos-fases')">M√©todo 2 Fases</button>
    </div>

    <!-- M√©todo Gr√°fico -->
    <div id="metodo-grafico" class="metodo-section">
        <div class="box">
            <h3>1. Funci√≥n Objetivo (Z)</h3>
            <select id="objetivo">
                <option value="max">Maximizar</option>
                <option value="min">Minimizar</option>
            </select>
            <div id="z-coefs-container-grafico" style="margin-top: 10px;">
                <span>Z = </span>
                <input type="number" class="z-coef-grafico" id="z_x" value="3" style="width: 50px;" data-var="0" inputmode="decimal" autocomplete="off">
                <span> X </span>
                <select class="z-op-grafico" id="z_op_y" style="width: 50px; margin: 0 5px; padding: 4px; text-align: center; font-size: 1.2em; font-weight: bold;">
                    <option value="+">+</option>
                    <option value="-">‚àí</option>
                </select>
                <input type="number" class="z-coef-grafico" id="z_y" value="2" style="width: 50px;" data-var="1" inputmode="decimal" autocomplete="off">
                <span> Y</span>
            </div>
            <br>
            <div style="margin-top: 10px;">
                <span style="font-size: 0.9em; color: var(--text-quaternary);">Nota: El m√©todo gr√°fico solo visualiza 2 variables (X y Y)</span>
            </div>
        </div>

        <div class="box">
            <!-- T√≠tulo con botones de modo -->
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <h3 style="margin: 0;">2. Restricciones</h3>
                <div class="restriction-mode-buttons">
                    <button class="restriction-mode-btn active" onclick="cambiarModoRestricciones('coeficientes')" data-mode="coeficientes">
                        Coeficientes
                    </button>
                    <button class="restriction-mode-btn" onclick="cambiarModoRestricciones('natural')" data-mode="natural">
                        Forma Natural
                    </button>
                </div>
            </div>
            
            <!-- Modo coeficientes (actual) -->
            <div id="modo-coeficientes">
                <div id="lista-restricciones">
                <div class="fila-restriccion">
                    <input type="number" class="res-x" value="2" style="width: 50px;" inputmode="decimal" autocomplete="off"> X 
                    <select class="res-op-var" style="width: 50px; margin: 0 5px; padding: 4px; text-align: center; font-size: 1.2em; font-weight: bold;">
                        <option value="+">+</option>
                        <option value="-">‚àí</option>
                    </select>
                    <input type="number" class="res-y" value="1" style="width: 50px;"> Y 
                    <select class="res-op">
                        <option value="<=">&le;</option>
                        <option value=">=">&ge;</option>
                        <option value="=">=</option>
                    </select>
                    <input type="number" class="res-val" value="100" style="width: 60px;">
                </div>
                <div class="fila-restriccion">
                    <input type="number" class="res-x" value="1" style="width: 50px;" inputmode="decimal" autocomplete="off"> X 
                    <select class="res-op-var" style="width: 50px; margin: 0 5px; padding: 4px; text-align: center; font-size: 1.2em; font-weight: bold;">
                        <option value="+">+</option>
                        <option value="-">‚àí</option>
                    </select>
                    <input type="number" class="res-y" value="1" style="width: 50px;"> Y 
                    <select class="res-op">
                        <option value="<=">&le;</option>
                        <option value=">=">&ge;</option>
                        <option value="=">=</option>
                    </select>
                    <input type="number" class="res-val" value="80" style="width: 60px;">
                </div>
                </div>
                <br>
                <button onclick="agregarRestriccionGrafico()" style="margin-top: 10px; background: #3498db;">+ Agregar Restricci√≥n</button>
                <button onclick="eliminarRestriccionGrafico()" style="margin-top: 10px; background: #e74c3c;">- Eliminar Restricci√≥n</button>
            </div>
            
            <!-- Modo forma natural (nuevo) -->
            <div id="modo-natural" style="display: none;">
                <div style="margin-bottom: 10px;">
                    <label for="restricciones-natural" style="display: block; margin-bottom: 5px; font-weight: bold;">
                        Ingresa las restricciones (una por l√≠nea):
                    </label>
                    <textarea 
                        id="restricciones-natural" 
                        rows="6" 
                        style="width: 100%; padding: 10px; font-family: monospace; border: 1px solid var(--border-primary); border-radius: 4px;"
                        placeholder="Ejemplos:&#10;y >= x&#10;y <= 2x&#10;x <= 30&#10;y <= 20&#10;x + y >= 10"
                    ></textarea>
                </div>
                <div class="info-box">
                    <strong>üí° Tips:</strong>
                    <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9em;">
                        <li>Usa "x" y "y" para las variables</li>
                        <li>Usa ">=", "<=", o "=" para los operadores</li>
                        <li>Ejemplos: "y >= x", "y <= 2x", "x + y <= 10"</li>
                        <li>Puedes combinar ambos modos: escribe en forma natural y luego cambia a coeficientes</li>
                    </ul>
                </div>
                <button onclick="convertirRestriccionesNaturales()" style="margin-top: 10px; background: #16a085;">Convertir a Coeficientes</button>
            </div>
            
            <br><br>
            <button onclick="resolverProblema()">CALCULAR SOLUCI√ìN</button>
        </div>
    </div>

    <!-- M√©todo Simplex -->
    <div id="metodo-simplex" class="metodo-section" style="display:none;">
        <div class="box">
            <h3>1. Funci√≥n Objetivo (Z)</h3>
            <select id="objetivo-simplex">
                <option value="max">Maximizar</option>
                <option value="min">Minimizar</option>
            </select>
            <div id="z-coefs-container" style="margin-top: 10px;">
                <span>Z = </span>
                <input type="number" class="z-coef" value="3" style="width: 50px;" data-var="0" inputmode="decimal" autocomplete="off">
                <span> X‚ÇÅ </span>
                <select class="z-op" data-var="1" style="width: 50px; margin: 0 5px; padding: 4px; text-align: center; font-size: 1.2em; font-weight: bold;">
                    <option value="+">+</option>
                    <option value="-">‚àí</option>
                </select>
                <input type="number" class="z-coef" value="2" style="width: 50px;" data-var="1" inputmode="decimal" autocomplete="off">
                <span> X‚ÇÇ</span>
            </div>
            <br>
            <button onclick="agregarVariableSimplex()" style="margin-top: 10px; background: #27ae60;">+ Agregar Variable</button>
            <button onclick="eliminarVariableSimplex()" style="margin-top: 10px; background: #e74c3c;">- Eliminar Variable</button>
        </div>

        <div class="box">
            <!-- T√≠tulo con botones de modo -->
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <h3 style="margin: 0;">2. Restricciones</h3>
                <div class="restriction-mode-buttons-simplex">
                    <button class="restriction-mode-btn-simplex active" onclick="cambiarModoRestriccionesSimplex('coeficientes')" data-mode="coeficientes">
                        Coeficientes
                    </button>
                    <button class="restriction-mode-btn-simplex" onclick="cambiarModoRestriccionesSimplex('natural')" data-mode="natural">
                        Forma Natural
                    </button>
                </div>
            </div>
            
            <!-- Modo coeficientes (actual) -->
            <div id="modo-coeficientes-simplex">
                <div id="lista-restricciones-simplex">
                    <!-- Las restricciones iniciales se agregar√°n din√°micamente -->
                </div>
                <br>
                <button onclick="agregarRestriccionSimplex()" style="margin-top: 10px; background: #3498db;">+ Agregar Restricci√≥n</button>
                <button onclick="eliminarRestriccionSimplex()" style="margin-top: 10px; background: #e74c3c;">- Eliminar Restricci√≥n</button>
            </div>
            
            <!-- Modo forma natural (nuevo) -->
            <div id="modo-natural-simplex" style="display: none;">
                <div style="margin-bottom: 10px;">
                    <label for="restricciones-natural-simplex" style="display: block; margin-bottom: 5px; font-weight: bold;">
                        Ingresa las restricciones (una por l√≠nea):
                    </label>
                    <textarea 
                        id="restricciones-natural-simplex" 
                        rows="6" 
                        style="width: 100%; padding: 10px; font-family: monospace; border: 1px solid var(--border-primary); border-radius: 4px;"
                        placeholder="Ejemplos:&#10;x1 + x2 <= 10&#10;2x1 + 3x2 >= 20&#10;x1 - x2 = 5&#10;x1 <= 30&#10;x2 >= 5"
                    ></textarea>
                </div>
                <div class="info-box">
                    <strong>üí° Tips:</strong>
                    <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9em;">
                        <li>Usa "x1", "x2", "x3", etc. para las variables</li>
                        <li>Usa ">=", "<=", o "=" para los operadores</li>
                        <li>Ejemplos: "x1 + x2 <= 10", "2x1 + 3x2 >= 20", "x1 - x2 = 5"</li>
                        <li>Puedes combinar ambos modos: escribe en forma natural y luego cambia a coeficientes</li>
                    </ul>
                </div>
                <button onclick="convertirRestriccionesNaturalesSimplex()" style="margin-top: 10px; background: #16a085;">Convertir a Coeficientes</button>
            </div>
            
            <br><br>
            <button onclick="resolverSimplex()">CALCULAR SOLUCI√ìN (SIMPLEX)</button>
        </div>
    </div>

    <!-- M√©todo 2 Fases -->
    <div id="metodo-dos-fases" class="metodo-section" style="display:none;">
        <div class="box">
            <h3>1. Funci√≥n Objetivo (Z)</h3>
            <select id="objetivo-dos-fases">
                <option value="max">Maximizar</option>
                <option value="min">Minimizar</option>
            </select>
            <div id="z-coefs-container-dos-fases" style="margin-top: 10px;">
                <span>Z = </span>
                <input type="number" class="z-coef-dos-fases" value="3" style="width: 50px;" data-var="0" inputmode="decimal" autocomplete="off">
                <span> X‚ÇÅ </span>
                <select class="z-op-dos-fases" data-var="1" style="width: 50px; margin: 0 5px; padding: 4px; text-align: center; font-size: 1.2em; font-weight: bold;">
                    <option value="+">+</option>
                    <option value="-">‚àí</option>
                </select>
                <input type="number" class="z-coef-dos-fases" value="2" style="width: 50px;" data-var="1" inputmode="decimal" autocomplete="off">
                <span> X‚ÇÇ</span>
            </div>
            <br>
            <button onclick="agregarVariableDosFases()" style="margin-top: 10px; background: #27ae60;">+ Agregar Variable</button>
            <button onclick="eliminarVariableDosFases()" style="margin-top: 10px; background: #e74c3c;">- Eliminar Variable</button>
        </div>

        <div class="box">
            <!-- T√≠tulo con botones de modo -->
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <h3 style="margin: 0;">2. Restricciones</h3>
                <div class="restriction-mode-buttons-dos-fases">
                    <button class="restriction-mode-btn-dos-fases active" onclick="cambiarModoRestriccionesDosFases('coeficientes')" data-mode="coeficientes">
                        Coeficientes
                    </button>
                    <button class="restriction-mode-btn-dos-fases" onclick="cambiarModoRestriccionesDosFases('natural')" data-mode="natural">
                        Forma Natural
                    </button>
                </div>
            </div>
            
            <!-- Modo coeficientes (actual) -->
            <div id="modo-coeficientes-dos-fases">
                <div id="lista-restricciones-dos-fases">
                    <!-- Las restricciones iniciales se agregar√°n din√°micamente -->
                </div>
                <br>
                <button onclick="agregarRestriccionDosFases()" style="margin-top: 10px; background: #3498db;">+ Agregar Restricci√≥n</button>
                <button onclick="eliminarRestriccionDosFases()" style="margin-top: 10px; background: #e74c3c;">- Eliminar Restricci√≥n</button>
            </div>
            
            <!-- Modo forma natural (nuevo) -->
            <div id="modo-natural-dos-fases" style="display: none;">
                <div style="margin-bottom: 10px;">
                    <label for="restricciones-natural-dos-fases" style="display: block; margin-bottom: 5px; font-weight: bold;">
                        Ingresa las restricciones (una por l√≠nea):
                    </label>
                    <textarea 
                        id="restricciones-natural-dos-fases" 
                        rows="6" 
                        style="width: 100%; padding: 10px; font-family: monospace; border: 1px solid var(--border-primary); border-radius: 4px;"
                        placeholder="Ejemplos:&#10;x1 + x2 <= 10&#10;2x1 + 3x2 >= 20&#10;x1 - x2 = 5&#10;x1 <= 30&#10;x2 >= 5"
                    ></textarea>
                </div>
                <div class="info-box">
                    <strong>üí° Tips:</strong>
                    <ul style="margin: 5px 0; padding-left: 20px; font-size: 0.9em;">
                        <li>Usa "x1", "x2", "x3", etc. para las variables</li>
                        <li>Usa ">=", "<=", o "=" para los operadores</li>
                        <li>Ejemplos: "x1 + x2 <= 10", "2x1 + 3x2 >= 20", "x1 - x2 = 5"</li>
                        <li>El m√©todo de 2 Fases es ideal cuando hay restricciones >= o =</li>
                    </ul>
                </div>
                <button onclick="convertirRestriccionesNaturalesDosFases()" style="margin-top: 10px; background: #16a085;">Convertir a Coeficientes</button>
            </div>
            
            <br><br>
            <button onclick="resolverDosFases()">CALCULAR SOLUCI√ìN (2 FASES)</button>
        </div>
    </div>

    <!-- Resultados M√©todo Gr√°fico -->
    <div class="box" id="resultados" style="display:none;">
        
        <div class="calculations-header">
            <h3 style="display: inline-block; margin: 0; border-bottom: 3px solid #7f8c8d;">
                1. C√°lculos y Evaluaciones
            </h3>
            <button id="toggle-calculations" class="toggle-btn" onclick="toggleCalculations()">
                <span id="toggle-icon">‚ñº</span> Ver Detalles
            </button>
        </div>
        <div id="calculations-summary" class="calculations-summary"></div>
        <div id="log-container" class="timeline" style="display:none;"></div>

        <h3><span style="border-bottom: 3px solid #3498db;">2. Gr√°fica de la Regi√≥n Factible</span></h3>
        <div id="grafico" style="width:100%; height:500px;"></div>

        <h3><span style="border-bottom: 3px solid #27ae60;">3. Tabla de Evaluaci√≥n de V√©rtices</span></h3>
        <div class="info-box" style="font-size: 0.9em;">
            <strong>üí° Explicaci√≥n:</strong> Esta tabla muestra c√≥mo se calcula el valor de la funci√≥n objetivo Z para cada v√©rtice de la regi√≥n factible. 
            El c√°lculo se realiza sustituyendo las coordenadas (X, Y) del v√©rtice en la funci√≥n objetivo.
        </div>
        <table class="tabla-resultados">
            <thead>
                <tr>
                    <th>V√©rtice (X, Y)</th>
                    <th>Valor Z</th>
                    <th>C√°lculo de Z</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody id="cuerpo-tabla"></tbody>
        </table>

        <div id="analisis-box" class="analysis-box">
            <h2 id="titulo-tipo-solucion">Soluci√≥n Final</h2>
            <p id="texto-explicacion"></p>
            <div id="caja-resultado-final" class="resultado-final-box" style="margin-top: 15px; font-size: 1.2em;"></div>
        </div>

    </div>

    <!-- Resultados M√©todo Simplex -->
    <div class="box" id="resultados-simplex" style="display:none;">
        
        <div class="calculations-header">
            <h3 style="display: inline-block; margin: 0; border-bottom: 3px solid #7f8c8d;">
                Pasos del Algoritmo Simplex
            </h3>
            <button id="toggle-calculations-simplex" class="toggle-btn" onclick="toggleCalculationsSimplex()">
                <span id="toggle-icon-simplex">‚ñº</span> Ver Detalles
            </button>
        </div>
        <div id="calculations-summary-simplex" class="calculations-summary"></div>
        <div id="log-container-simplex" class="timeline" style="display:none;"></div>

        <h3><span style="border-bottom: 3px solid #9b59b6;">Tablas del Simplex</span></h3>
        <div id="tablas-simplex-container"></div>

        <div id="analisis-box-simplex" class="analysis-box">
            <h2 id="titulo-tipo-solucion-simplex">Soluci√≥n Final</h2>
            <p id="texto-explicacion-simplex"></p>
            <div id="caja-resultado-final-simplex" class="resultado-final-box" style="margin-top: 15px; font-size: 1.2em;"></div>
        </div>

    </div>

    <!-- Resultados M√©todo 2 Fases -->
    <div class="box" id="resultados-dos-fases" style="display:none;">
        
        <div class="calculations-header">
            <h3 style="display: inline-block; margin: 0; border-bottom: 3px solid #7f8c8d;">
                Pasos del M√©todo de las Dos Fases
            </h3>
            <button id="toggle-calculations-dos-fases" class="toggle-btn" onclick="toggleCalculationsDosFases()">
                <span id="toggle-icon-dos-fases">‚ñº</span> Ver Detalles
            </button>
        </div>
        <div id="calculations-summary-dos-fases" class="calculations-summary"></div>
        <div id="log-container-dos-fases" class="timeline" style="display:none;"></div>

        <h3><span style="border-bottom: 3px solid #9b59b6;">Tablas del M√©todo de 2 Fases</span></h3>
        <div id="tablas-dos-fases-container"></div>

        <div id="analisis-box-dos-fases" class="analysis-box">
            <h2 id="titulo-tipo-solucion-dos-fases">Soluci√≥n Final</h2>
            <p id="texto-explicacion-dos-fases"></p>
            <div id="caja-resultado-final-dos-fases" class="resultado-final-box" style="margin-top: 15px; font-size: 1.2em;"></div>
        </div>

    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // Verificaci√≥n adicional de que todo se carg√≥
        if (typeof resolverProblema === 'undefined') {
            console.error('Error cr√≠tico: El script main.js no se carg√≥ correctamente');
            document.body.innerHTML = '<div style="padding: 20px; text-align: center;"><h1>Error al cargar la aplicaci√≥n</h1><p>Por favor, recarga la p√°gina o verifica tu conexi√≥n a internet.</p></div>';
        }
    </script>
</body>
</html>